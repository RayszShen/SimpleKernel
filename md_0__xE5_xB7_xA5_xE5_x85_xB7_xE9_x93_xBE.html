<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SimpleKernel: SimpleKernel 工具链</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SimpleKernel
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_0__xE5_xB7_xA5_xE5_x85_xB7_xE9_x93_xBE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SimpleKernel 工具链 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>SimpleKernel 为了保证在各个平台上的可用性，选择了较为通用的工具链，主要分为三个部分</p>
<ol type="1">
<li><p class="startli">构建系统</p>
<p class="startli">使用 CMake 对代码进行管理，同时控制编译选项</p>
</li>
<li><p class="startli">内核的编译</p>
<p class="startli">使用 GCC 工具链</p>
</li>
<li><p class="startli">模拟器</p>
<p class="startli">对于 x86/x86_64 架构，支持 bochs 与 qemu</p>
<p class="startli">arm/aarch64/riscv64 架构，使用 qemu</p>
</li>
<li><p class="startli">辅助脚本</p>
<p class="startli">主要用于环境变量管理，如 <code>./run.sh</code> 是用来编译并运行内核，<code>./tools/env.sh</code> 则规定了需要的参数。</p>
<p class="startli">此外还有模拟器配置，如 <code>./bochsrc_linux.txt</code></p>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md1"></a>
CMake</h1>
<p>CMake 可以分为两个部分</p>
<ol type="1">
<li><p class="startli">主要 cmake 规则</p>
<p class="startli">所有 CMakeLists.txt 文件，规定了内核的编译方式。</p><ul>
<li><p class="startli">./CMakeLists.txt</p>
<p class="startli">设置了一些 CMake 选项，并在最后通过 <code>add_subdirectory(${${SimpleKernel_SOURCE_DIR}/src})</code> 将控制权转移到 ./src/CMakeLists.txt</p>
</li>
<li><p class="startli">./src/CMakeLists.txt</p>
<p class="startli">规定了 gcc 的编译选项，指定生成的二进制文件名称，并规定生成二进制文件所需的模块</p>
</li>
<li><p class="startli">./src/*/CMakeLists.txt</p>
<p class="startli">各个模块的编译规则</p>
</li>
</ul>
</li>
<li><p class="startli">辅助 cmake 规则</p>
<p class="startli">用于辅助主要规则，保存在 ./cmake 目录下</p><ul>
<li>toolchain_*.cmake 用于判断依赖是否已安装</li>
<li>header_files.cmake 用于添加头文件</li>
<li>find_asm_files.cmake 用于将汇编文件添加到编译列表</li>
<li>arch_detector.cmake 用于判断目标架构</li>
</ul>
</li>
</ol>
<p>更多细节请查看注释。</p>
<p>项目地址：<a href="https://cmake.org">CMake</a></p>
<h1><a class="anchor" id="autotoc_md2"></a>
GCC</h1>
<p>GCC 需要根据目标平台与宿主机进行配置，即 target 与 host。</p>
<p>一般而言，网上有编译好的可以直接拿来用。</p>
<p>以 target=riscv64，host=osx 为例，可以在 <code><a href="https://github.com/riscv/homebrew-riscv">https://github.com/riscv/homebrew-riscv</a></code> 找到现成的，只需要按照说明安装即可。</p>
<p>对于特殊情况，可能需要自己手动编译 gcc，大致步骤如下<a href="https://gcc.gnu.org/install/">^1</a>：</p>
<ol type="1">
<li>安装依赖</li>
<li>下载源码</li>
<li>配置</li>
<li>编译</li>
</ol>
<p>其中比较重要的地方是第三步，需要根据需要进行配置，你可以参考 ./tools/x86_64-elf-gcc.sh 的内容进行编译。</p>
<p>项目地址：<a href="https://gcc.gnu.org">GCC, the GNU Compiler Collection - GNU Project</a></p>
<h1><a class="anchor" id="autotoc_md3"></a>
bochs</h1>
<p>bochs 是专门用于 x86/x86_64 的虚拟机。</p>
<p>./tools/bochsrc_*.txt 规定了虚拟机的配置选项</p>
<p>./tools/bochsinit 规定在虚拟机启动后执行的命令</p>
<p>项目地址：<a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwibsOK5v5b4AhUFD0QIHTX-BS4QFnoECBMQAQ&amp;url=https%3A%2F%2Fbochs.sourceforge.io%2F&amp;usg=AOvVaw22vn_4SPHPDYUk_NoYgyP2">bochs: The Open Source IA-32 Emulation Project (Home Page)</a></p>
<p>更多细节请查看注释</p>
<h1><a class="anchor" id="autotoc_md4"></a>
qemu</h1>
<p>qemu 是支持范围更大的虚拟机，支持多种架构。</p>
<p>安装：</p>
<p>项目地址：<a href="https://www.qemu.org">QEMU</a></p>
<h1><a class="anchor" id="autotoc_md5"></a>
辅助脚本</h1>
<ul>
<li><p class="startli">./tools/env.sh</p>
<p class="startli">设置目标架构，并根据设置的目标架构初始化相关变量。</p>
<p class="startli">更多细节请查看注释。</p>
</li>
<li><p class="startli">./run.sh</p>
<p class="startli">根据 tools/env.sh 的设置在虚拟机中运行内核。</p>
<p class="startli">更多细节请查看注释。</p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
相关文档</h1>
<p>关于交叉编译的一些说明：https://wiki.osdev.org/GCC_Cross-Compiler</p>
<p>arm 工具链：https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-a/downloads</p>
<p>riscv 工具链：https://github.com/riscv/riscv-gnu-toolchain </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Sep 12 2023 13:20:13 for SimpleKernel by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
